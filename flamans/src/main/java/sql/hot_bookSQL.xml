<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="flamans.hot.book">
   <insert id="booking_hot" parameterType="flamans.hot.book.model.Hot_bookDTO">
      insert
         into
      fm_hot_book
         values(#{hot_num},
         #{name},
            #{sex},
                  #{nationality},
         #{checkin},        
            #{checkout},
         #{card},
            sysdate,
            #{people},
         #{roomselect},
            #{permit},
         fm_hot_book_bookingnum.nextval,
         #{room_idx})
   </insert>
   <select id="hot_info" resultType="flamans.member.model.MemberDTO">
        select * from fm_member where m_id=#{m_id}
   </select>
   <select id="fm_hotroom" resultType="flamans.hotel_find.model.HotelRoomDTO">
      select * from fm_hotroom where hot_num=#{hot_num}
   </select> 
    <select id="Hbook_list" parameterType="Map" resultType="flamans.hot.book.model.Hot_bookDTO">
		select h.*, roomname
		from
			 fm_hot_book h, fm_hotroom r
		where h.hot_num=#{hot_num} and r.room_idx=h.room_idx and
		 (to_char(checkin,'yyyy-MM-DD')) like ''||#{checkin}||'%'
		order by 
			checkin
	</select>   
   <select id="fm_myhot_book" resultType="flamans.hot.book.model.Hot_bookDTO">
      select hot_num,
         name,
            sex,
         nationality,
         TO_CHAR(checkin,'YYYY-MM-DD') checkin
     , TO_CHAR(checkout,'YYYY-MM-DD') checkout,
        card           
     , TO_CHAR(bookingdate,'YYYY-MM-DD') bookingdate,
         people,
        roomselect,
        permit,
        bookingnum
      from fm_hot_book where name = #{m_id}
   </select>
   <select id="fm_hotname" resultType="flamans.company.model.CompanyDTO">
      select cm_name from fm_company where cm_number = #{hot_num}   
   </select>
   <update id="HBook_request" parameterType="Map">
		update 
			fm_hot_book
		set
			permit=1
		where 	
			bookingnum=#{bookingnum} and hot_num=#{hot_num}
	</update>
	
	<delete id="HBook_del" parameterType="Map">
		delete from fm_hot_book
		where hot_num=#{hot_num} and bookingnum=#{bookingnum}
	</delete>

   <update id="fm_hotroomnum" parameterType="Map">
		update
			fm_hotroom
		set roomnum=roomnum-#{roomselect}
		where room_idx = #{room_idx}
   </update>

</mapper>  